---
title: "LESO data wrangling"
date: "`r Sys.Date()`"
output:
  html_document:
    theme: flatly
    toc: true
    toc_depth: 3
    toc_float: true
    df_print: paged
knit: (function(inputFile, encoding) { rmarkdown::render(inputFile, encoding = encoding, output_dir = "docs") })
---

This notebook processes [data](https://www.dla.mil/DispositionServices/Offers/Reutilization/LawEnforcement/PublicInformation/) by the Defense Logistics Agency about military surplus transfers to local law enforcement through the Law Enforcement Support Office (LESO) or [LESO Program](https://www.dla.mil/DispositionServices/Offers/Reutilization/LawEnforcement/).

The data is updated quarterly. As of this date, the file name is linked from the headline "ALASKA - WYOMING AND US TERRITORIES".

The spreadsheet has a a sheet for each state. This notebook puts all the sheets together into a single dataset for easier analysis.

> An important note: In 2020 I asked the LESO office about the `acquisition_value` measure and found that it should be *multiplied* by the `quantity`. The value is for single item.

In addition, I asked about why there are different prices for the same item, and received the following response on 2020-12-14:

> You are correct, the NSN is the National Stock Number.
> The primary reason a similar item has a different NSN designation is classification difference.  In some cases, this could be difference in features, a frequently added component to the item, or variance in storage requirements such as the recent vaccinees that are being assigned NSNs for DLAâ€™s major subordinate command, Troop Support. 
> The cost information is provided by the customer when they turn the items into DLA Disposition Services. Acquisition values can vary for numerous reasons. One is the above, variance in classification differences such as modifications. As with most commodities, other factors could include variance in acquisition cost depending on the quantity procured and the year acquired.

## Related data

- Two values are considered [Demil Codes](https://www.dla.mil/HQ/LogisticsOperations/Services/FIC/DEMILCoding/DEMILCodes/) which note how an item must be tracked or destroyed?
- There is also the `NSN` value, or [National Stock Number](https://www.dla.mil/AboutDLA/News/NewsArticleView/Article/1933320/what-is-a-national-stock-number/).

## Setup

```{r setup, echo=T, results='hide', message=F, warning=F}
library(tidyverse)
library(readxl)
library(janitor)
```

## Import

```{r import}
# set path to data
## change name to update to new file
path <- "data-raw/AllStatesAndTerritoriesQTR3FY21.xlsx"

# import and combine sheets
leso <- path %>%
  excel_sheets() %>%
  map_df(~ read_excel(path = path, sheet = .x), .id = "sheet") %>% 
  clean_names()

# peek at names
leso %>% names()
```

```{r peek}
# peek at df
leso %>% head()

```

```{r glimpse}
# glimpse at df
leso %>% glimpse()
```

```{r}
leso %>% summary()
```

## Texas

Filter for Texas agencies

```{r texas}
tx <- leso %>% 
  filter(state == "TX")

```

## Write files

Write files for export for future notebooks or other reasons.

```{r export}

# write data to csv
leso %>% 
  write_csv("data-processed/leso.csv")

leso %>% 
  write_rds("data-processed/leso.rds")

# klaxon on complete
beepr::beep(4)
```

