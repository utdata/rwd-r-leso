---
title: "LESO data wrangling"
date: "`r Sys.Date()`"
output:
  html_document:
    theme: flatly
    toc: true
    toc_depth: 3
    toc_float: true
    df_print: paged
knit: (function(inputFile, encoding) { rmarkdown::render(inputFile, encoding = encoding, output_dir = "docs") })
---

> MOST RECENT DATA: March 31, 2022. MIGHT NEED CLEANING UPDATE WITH NEXT DATA UPDATE.

This notebook processes [data](https://www.dla.mil/DispositionServices/Offers/Reutilization/LawEnforcement/PublicInformation/) by the Defense Logistics Agency about military surplus transfers to local law enforcement through the Law Enforcement Support Office (LESO) or [LESO Program](https://www.dla.mil/DispositionServices/Offers/Reutilization/LawEnforcement/).

The data is updated quarterly. As of this date, the file name is linked from the headline "ALASKA - WYOMING AND US TERRITORIES".

The spreadsheet has a a sheet for each state. This notebook puts all the sheets together into a single dataset for easier analysis.

There is some cleaning done here based on June 2022 research. See the README.

## Setup

```{r setup, echo=T, results='hide', message=F, warning=F}
library(tidyverse)
library(readxl)
library(janitor)
```

## Import

```{r import}
# set path to data
## change name to update to new file
path <- "data-raw/AllStatesAndTerritoriesQTR3FY22.xlsx"

# import and combine sheets
leso <- path %>%
  excel_sheets() %>%
  map_df(~ read_excel(path = path, sheet = .x), .id = "sheet") %>% 
  clean_names()

# peek at names
leso %>% names()
```

```{r peek}
# peek at df
leso %>% head()

```

```{r glimpse}
# glimpse at df
leso %>% glimpse()
```

```{r}
leso %>% summary()
```

## Clean up RECON SCOUT XT,SPEC

Here we need to change any records that

```{r}
leso_cleaned <- leso |> 
  mutate(
    demil_code = case_when(
      item_name == "RECON SCOUT XT,SPEC" ~ "D",
      TRUE ~ demil_code
    )
  )
```


## Write files

Write files for export for future notebooks or other reasons.

```{r export}

# write data to csv
leso_cleaned %>% 
  write_csv("data-processed/leso.csv")

leso_cleaned %>% 
  write_rds("data-processed/leso.rds")

# leso %>%
#   write_rds("data-processed/leso-qtr1fy22.rds")

# klaxon on complete
beepr::beep(4)
```

