---
title: "LESO Explore"
output:
  html_document:
    theme: flatly
    toc: true
    toc_depth: 3
    toc_float: true
    df_print: paged
knit: (function(inputFile, encoding) { rmarkdown::render(inputFile, encoding = encoding, output_dir = "docs") })
---

John Templon at Buzzfeed wondered why the acquisition_value was different for the same item listed in the LESO data. This explores that concept.

## Setup

```{r setup, echo=T, results='hide', message=F, warning=F}
library(tidyverse)
library(lubridate)
```

## Import

```{r import}
leso <- read_rds("data-processed/leso.rds")

# columns of interest
cols <- c(
  "agency_name",
  "item_name",
  "quantity",
  "ui",
  "acquisition_value",
  "ship_date",
  "station_type"
  )
```



## Price differences

A quick look at popular item names in the data.

```{r}
leso %>% 
  count(item_name) %>% 
  arrange(n %>% desc())
```

Let's look at "RIFLE,5.56 MILLIMETER". Filter for those.

```{r}
rifles <- leso %>% 
  filter(item_name == "RIFLE,5.56 MILLIMETER")
```

Apparently rifles of different NSN (National Stock Number) can have different prices.

```{r}
rifles %>% 
  count(nsn, acquisition_value)
```

I sent a query on 2020-12-12 to LESO to see if there is a data source for NSN. I believe further searching might reveal, but also might require a level of government access.

## Demil codes

There are two [Demil codes](https://www.dla.mil/HQ/LogisticsOperations/Services/FIC/DEMILCoding/DEMILCodes/) listed for each item. They relate to the level of destruction needed for each item.

With the list above we could build a lookup table. Not sure if it is warranted.

Looking here at how they are distributed.

```{r}
leso %>% 
  count(demil_code)
```

```{r}
leso %>% 
  count(demil_ic)
```


## Controlled vs non-controlled property

I thought there was a major data issue when numbers from two different data downloads until I read more about [controlled vs non-controlled property](https://www.dla.mil/dispositionservices//Offers/Reutilization/LawEnforcement/ProgramFAQs/#q6) on the [LESO Public Information page](https://www.dla.mil/DispositionServices/Offers/Reutilization/LawEnforcement/PublicInformation/). Non-controlled items like boots or blankets (as opposed to guns) are removed from the database after a year, so there is a big drop in the number of records for recent years. Interesting, the number of records from past years does change over time, but not to the same degree. I have not explored those differences.

Import two different downloads from about 6 months apart.

```{r}
leso_qtr1fy22 <- read_rds("data-processed/leso-qtr1fy22.rds")
leso_qtr3fy21 <- read_rds("data-processed/leso-qtr3fy21.rds")

```


Newer data seems to have fewer records than the last update so I wondering why.

Count records from the newer data

```{r}
leso_22 <- leso_qtr1fy22 %>% 
  count(year = year(ship_date), name = "qtr1fy22") %>% 
  arrange(year %>% desc()) %>% 
  mutate(year = year %>% as.character())

leso_22
```

Count records from older data

```{r}
leso_21 <- leso_qtr3fy21 %>% 
  count(year = year(ship_date), name = "qtr3fy21") %>% 
  arrange(year %>% desc()) %>% 
  mutate(year =  year %>% as.character())

leso_21
```

Join the two files together and calculate the difference in records

```{r}
leso_21 %>% 
  left_join(leso_22) %>% 
  mutate(diff = qtr1fy22 - qtr3fy21)
```

## exploring non-controlled property

Unfortunately there is no way in the data to tell what is controlled or not.

```{r}
leso_qtr1fy22 %>% 
  filter(year(ship_date) == 2021) %>% 
  count(item_name, sort = T)
```

