---
title: "LESO Texas and Austin"
date: "`r Sys.Date()`"
output:
  html_document:
    theme: flatly
    toc: true
    toc_depth: 3
    toc_float: true
    df_print: paged
knit: (function(inputFile, encoding) { rmarkdown::render(inputFile, encoding = encoding, output_dir = "docs") })
---

## Setup

```{r setup, echo=T, results='hide', message=F, warning=F}
library(tidyverse)
```

## Import

```{r import}
leso <- read_rds("data-processed/leso.rds")
austin_msa_agencies <- read_csv("data-raw/austin_msa_agencies.csv")

cols <- c(
  "agency_name",
  "item_name",
  "quantity",
  "ui",
  "acquisition_value",
  "ship_date"
  )
```

## Glimpse the data


```{r}
leso %>% glimpse()
```


## Filter to TX

```{r tx}
tx <- leso %>% 
  filter(state == "TX")
```

## Central Texas

This is a list of agencies from utdata/rwd-police-agencies for comparison.


```{r show_agencies}
austin_msa_agencies %>% 
  arrange(agency)
```


```{r stations}
tx %>% 
  group_by(agency_name) %>%
  count()
```


### Make a list of Austin MSA agencies

This is a very suspect list because it comes from looking through the available agencies "by hand" from the Sept 2020 data.

> Not yet checked to list above

```{r austinmsa}

aus_msa_list <- c(
  "AUSTIN POLICE DEPT",
  "BASTROP COUNTY SHERIFF'S OFFICE",
  "BASTROP POLICE DEPT",
  "BEE CAVE POLICE DEPT",
  "BUDA POLICE DEPT",
  "CALDWELL COUNTY SHERIFFS OFFICE",
  "CEDAR PARK POLICE DEPT",
  "ELGIN POLICE DEPARTMENT",
  "GEORGETOWN POLICE DEPT",
  "HAYS CO CONSTABLE PRECINCT 4",
  "HAYS COUNTY SHERIFFS OFFICE",
  "HUTTO POLICE DEPT",
  "KYLE POLICE DEPT",
  "LAGO VISTA POLICE DEPT",
  "LEANDER POLICE DEPT",
  "LULING POLICE DEPT",
  "MANOR POLICE DEPT",
  "PFLUGERVILLE POLICE DEPT",
  "SAN MARCOS POLICE DEPT",
  "TRAVIS COUNTY SHERIFFS OFFICE",
  "UNIV OF TEXAS SYSTEM POLICE HI_ED",
  "WILLIAMSON COUNTY SHERIFF'S OFFICE"
)

aus_msa <- tx %>% 
  filter(agency_name %in% aus_msa_list)
```

### Austin MSA

```{r}
aus_msa %>% 
  group_by(agency_name) %>% 
  summarize(
    cnt = n(),
    total_value = sum(acquisition_value * quantity)
  ) %>% 
  arrange(total_value %>% desc())
```

### Williamson County Sheriff

```{r wilco}
wilco <- aus_msa %>% 
  filter(agency_name == "WILLIAMSON COUNTY SHERIFF'S OFFICE")

wilco %>% 
  select(cols) %>% 
  group_by(item_name) %>% 
  summarize(
    cnt = sum(quantity),
    total_value = sum(acquisition_value * quantity)
    ) %>% 
  arrange(total_value %>% desc())
```

```{r}
wilco %>% 
  filter(
    item_name == "RIFLE,7.62 MILLIMETER"
  ) %>% 
  select(cols)
```

## Texas higher education

Look for K-12 and HI_ED

```{r}
tx %>% 
  filter(
    str_detect(agency_name, "HI_ED")
  ) %>% 
  group_by(agency_name) %>% 
  summarise(
    cnt = sum(quantity),
    total_value = sum(quantity * acquisition_value)
  ) %>% 
  arrange(total_value %>% desc())
```

## Texas local school districts

```{r}
tx %>% 
  filter(
    str_detect(agency_name, "K-12")
  ) %>% 
  group_by(agency_name) %>% 
  summarise(
    cnt = sum(quantity),
    total_value = sum(quantity * acquisition_value)
  ) %>% 
  arrange(total_value %>% desc())

```

### Spring Branch

```{r}
tx %>% 
  filter(
    agency_name == "SPRING BRANCH ISD PD K-12"
  ) %>% 
  group_by(item_name) %>% 
  summarise(
    cnt = sum(quantity),
    total_value = sum(quantity * acquisition_value)
  )
```

Checking pistol

```{r}
tx %>% 
  filter(
    agency_name == "SPRING BRANCH ISD PD K-12",
    item_name == "PISTOL,CALIBER .45,AUTOMATIC"
  ) %>% select(cols, -agency_name)
```

